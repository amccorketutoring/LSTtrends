from pathlib import Path
from lsttrends.analysis import UHI_Vulnerability_Index_Knox as vulnerability
import pandas as pd

# Set up output path
HERE = Path(__file__).resolve().parent
OUTPUT_DIR = HERE.parent / "outputs"
OUTPUT_DIR.mkdir(parents=True, exist_ok=True)
output_path = OUTPUT_DIR / "UHI_Vulnerability_Test_Plot.png"

# 🧪 TEST: Run the vulnerability analysis and confirm the index is created
print("\n🔍 Running UHI vulnerability computation...")

# Load and process manually since the original script does not return values
df = pd.read_csv(HERE.parent / "data" / "Knox_UHI_Zonal_Stats_STRM.csv")
assert "LST_Celsius" in df.columns, "Missing LST_Celsius in data"
assert "NDVI" in df.columns, "Missing NDVI in data"

# Call the script as a module to check that nothing breaks
try:
    exec(
        open(
            HERE.parent / "lsttrends" / "analysis" / "UHI_Vulnerability_Index_Knox.py"
        ).read()
    )
    print("✅ Vulnerability analysis executed without errors.")
except Exception as e:
    print(f"❌ Error occurred during execution: {e}")
